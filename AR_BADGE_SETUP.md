# AR Voting Badge with Digital Ink Setup Guide

## Overview
This feature allows users to get a digital voting ink mark on their index finger after casting a vote. The system uses:
- **Python Flask service** for QR code generation
- **MediaPipe Hands** (YOLO-like detection) for finger detection
- **AR overlay** to display digital ink on the detected index finger

## Setup Instructions

### 1. Python QR Code Service

#### Install Dependencies
```bash
cd backend
pip install -r requirements.txt
```

#### Start the Service
**Windows:**
```bash
start_qr_service.bat
```

**Linux/Mac:**
```bash
chmod +x start_qr_service.sh
./start_qr_service.sh
```

**Or manually:**
```bash
python qr_service.py
```

The service will run on `http://localhost:5001`

### 2. Frontend Setup

The frontend dependencies are already installed. The following components are available:

- `ARFingerInk.tsx` - Main AR component with finger detection and ink overlay
- `QRScannerAR.tsx` - QR code scanner component
- `/ar-badge` - AR badge page route

### 3. How It Works

1. **User casts a vote** → Vote is recorded on blockchain
2. **QR code is generated** → Python service generates QR code with voting data
3. **User scans QR code** → QR scanner validates and unlocks AR experience
4. **Camera opens** → Front-facing camera activates
5. **Finger detection** → MediaPipe Hands detects index finger
6. **Digital ink applied** → AR overlay shows digital ink mark on index finger
7. **Share option** → User can share their voting badge on social media

## File Structure

```
backend/
├── qr_service.py          # Python Flask service for QR generation
├── requirements.txt       # Python dependencies
├── start_qr_service.sh    # Linux/Mac startup script
└── start_qr_service.bat   # Windows startup script

frontend/
├── components/
│   ├── ARFingerInk.tsx    # AR finger detection and ink overlay
│   └── QRScannerAR.tsx    # QR code scanner
└── app/
    └── ar-badge/
        └── page.tsx       # AR badge page
```

## API Endpoints

### Generate QR Code
**POST** `http://localhost:5001/api/qr/generate`
```json
{
  "voterId": "VC123456789012345",
  "electionId": "1",
  "transactionHash": "0x..."
}
```

### Verify QR Code
**POST** `http://localhost:5001/api/qr/verify`
```json
{
  "qrData": "voting-badge-ar://VC123456789012345/1/0x..."
}
```

## Features

### Digital Ink Mark
- Dark brown ink color (traditional voting ink appearance)
- "V" symbol overlay
- Glow effect for visibility
- Positioned on index finger tip

### Finger Detection
- Uses MediaPipe Hands for accurate finger detection
- Detects index finger tip and joint
- Real-time tracking
- Fallback detection if MediaPipe fails

### QR Code
- Generated by Python service
- Contains voting transaction data
- Validated before unlocking AR experience
- Base64 encoded image for easy display

## Troubleshooting

### Camera Access Issues
- Ensure browser permissions allow camera access
- Use HTTPS for production (required for camera access)
- Check browser console for errors

### MediaPipe Not Loading
- Check internet connection (loads from CDN)
- Fallback detection will activate automatically
- Verify `@mediapipe/hands` is installed

### QR Service Not Responding
- Verify Python service is running on port 5001
- Check firewall settings
- Ensure Flask and dependencies are installed

### Finger Not Detected
- Ensure good lighting
- Position index finger clearly in camera view
- Keep hand steady
- Check camera permissions

## Testing

1. Start Python QR service
2. Start frontend development server
3. Cast a vote through the voting interface
4. When prompted, choose to unlock AR badge
5. Scan the generated QR code
6. Show index finger to camera
7. Digital ink should appear on finger

## Production Considerations

- Use HTTPS for camera access
- Host MediaPipe models locally instead of CDN
- Add error handling and retry logic
- Implement rate limiting for QR generation
- Add authentication for QR service endpoints
- Optimize MediaPipe model loading

